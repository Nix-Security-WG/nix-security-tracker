{% extends "base.html" %}
{% load viewutils %}

{% block content %}
<h1>Selected suggestions</h1>
<p>
<span class="hint green-button">Create draft</span> to convert the suggestion into a draft security issue that can be edited before publishing. <s><a href="/drafts">View all drafts</a></s>
</p>
<p>
<span class="hint red-button">Dismiss</span> to remove a suggestion from the queue. <a href="/dismissed">View all dismissed suggestions</a>
</p>
<div id="suggestion-list">
  {% for object in object_list %}
    <article class="suggestion">
      <div class="row1">
        <a class="cve-id" href="https://nvd.nist.gov/vuln/detail/{{ object.cve.cve_id | urlencode }}">
          {{ object.cve.cve_id }}
        </a>
        <div class="severity {{ object.base_severity }}">
          {% if object.base_severity == "LOW" %}
            Low
          {% elif object.base_severity == "MEDIUM" %}
            Medium
          {% elif object.base_severity == "HIGH" %}
            High
          {% elif object.base_severity == "CRITICAL" %}
            Critical
          {% elif object.base_severity == "NONE" %}
            No severity data
          {% else %}
            Unknown Severity
          {% endif %}
        </div>
      </div>
      <h2>{{ object.package_name }}</h2>
      <!-- XXX: just another idea how to do it -->
      <details class="description">
        <summary>
            {% if object.title %}{{ object.title }}{% else %}{{ object.description|truncatewords:10 }}{% endif %}
        </summary>
        <p class="description-long as-details">{{ object.description }}</p>
      </details>
      <div class="nixpkgs-packages">
        {% for attribute, nixos_channels in object.packages.items %}
          <article class="nixpkgs-package">
            <h3><span class="pkgs">pkgs.</span>{{ attribute }}</h3>
            <ul class="channel-list">
              {% for major_channel, val in nixos_channels %}
                <li>
                  <details {% if val.uniform_versions %}open{% endif %}>
                    <summary>
                      <span class="branch-major">
                        <span class="branch-name">{{ major_channel }}</span>
                        <span class="version">{% if val.major_version %}{{ val.major_version }}{% else %}???{% endif %}</span>
                      </span>
                    </summary>
                    <ul class="channel-list">
                    {% for branch_name, version in val.sub_branches %}
                      <li class="branch-minor">
                        <span class="branch-name">{{ branch_name }}</span>
                        <span class="version">{{ version }}</span>
                      </li>
                    {% endfor %}
                    </ul>
                  </details>
                </li>
              {% endfor %}
            </ul>
          </article>
        {% endfor %}
      </div>
      <div class="change-issue-state">
        {% suggestion_state_button suggestion_id=object.id state="REJECTED" label="Dismiss" style="red-button" %}
        {% suggestion_state_button suggestion_id=object.id state="ACCEPTED" label="C̶̖͆r̶͍̚e̵͈̐ă̷̖t̷̄͜e̶͓̓ ̴̟̏d̵̳̅r̸̮̐a̵͍͑f̵̙̋t̴̹̃" style="green-button" %}
      </div>
    </article>
  {% endfor %}
</div>
{% endblock content %}

{% block pagination %}
  <ul>
    {% for page_number in adjusted_elided_page_range %}
      <li class="index">
        {% if page_number == paginator.ELLIPSIS %}
        {{page_number}}
        {% else %}
        <a href="{{request.path}}?page={{page_number}}" class="{% if page_number == page_obj.number %}current{% endif %}">
          {{page_number}}
        </a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endblock %}
